(function(d){function b(h,g){var f=new Date(h);if((g.max-g.min)<=86400000){return((f.getHours()<10?"0":"")+f.getHours()+":"+(f.getMinutes()<10?"0":"")+f.getMinutes())}else{return(f.getDate()+"."+(f.getMonth()+1)+"."+f.getFullYear())}}function c(j){var f=j.status.length?j.status:[{label:"No hosts",data:[[1,1]]}];var g=0;for(var h=0;h<f.length;h++){if(f[h].data){g++}}d.plot(d("#status"),f,{series:{pie:{show:true,stroke:{width:0},radius:0.99,highlight:{opacity:0},label:{show:true,radius:g>1?0.6:0,threshold:0.05,formatter:function(i,k){return'<div style="font-size:10pt;text-align:center;color:white;">'+i+"<br/>"+Math.round(k.percent)+"%</div>"}}}},grid:{hoverable:true,clickable:true,autoHighlight:false},colors:j.status.length?["#C0392B","#E74C3C","#F39C12","#2ECC71","#bec3c7","#95a4a7"]:["#95a4a7"],legend:{show:false}})}function e(f){d.each(f.events,function(h,g){d.each(g.data,function(i,j){j[0]*=1000})});d.plot(d("#events"),f.events,{series:{stack:true,lines:{show:false},bars:{show:true,fill:true,lineWidth:0,barWidth:600000,align:"center",fillColor:{colors:[{opacity:1},{opacity:1}]}},points:{show:false}},colors:["#E74C3C","#F39C12","#2ECC71"],xaxis:{tickLength:0,min:f.datefrom*1000,max:f.dateto*1000,tickFormatter:b},yaxis:{min:0,tickDecimals:0,minTickSize:1},legend:{show:false},grid:{borderWidth:0,autoHighlight:false,hoverable:true,clickable:true,mouseActiveRadius:5}});d("#events").on("plothover",{suffix:" events",data:f.events},MMONIT.chart.setTooltip)}d(document).ajaxError(function(i,g,h,f){MMONIT.error.json(g,f)});var a=new function(){var f=this;f.timeout=null;f.loadErrors=0;f.issues=ko.observableArray();f.issuesTotal=ko.observable();f.showwelcome=ko.observable(false);f.welcome=ko.observable(d("#showwelcome").val());f.dismissEvent=function(h){d.post("reports/events/dismiss","id="+h.eventid,function(i){f.issues.remove(h);f.issuesTotal(f.issuesTotal()-1);if((f.issues().length<1)&&f.issuesTotal()){f.load()}})};f.closeWelcome=function(){if(f.welcome()===false){d.post("index.csp","dismiss=1")}else{if(f.showwelcome()){d.post("session/put","welcome=0")}}d("#welcome").hide()};f.reload=function(){var h=d.Deferred();clearTimeout(f.timeout);f.timeout=setTimeout(function(){f.load();h.resolve()},10000);return h.promise()};f.load=function(){d.when(d.getJSON("status/hosts/summary"),d.getJSON("reports/events/summary"),d.getJSON("reports/events/list?active=2")).then(function(i,j,h){c(i[0]);e(j[0]);f.issues.removeAll();d.each(h[0].records,function(l,k){f.issues.push(new g(k))});f.issuesTotal(h[0].totalRecords);if(!MMONIT.error.ishidden()){MMONIT.error.hide()}}).then(f.reload())};var g=function(h){var i=this;i.date=strftime("%b %d %Y %H:%M:%S",new Date(h.date*1000));i.host=h.hostname;i.hostid=h.hostid;i.service=h.servicename;i.eventid=h.id;i.servicenameid=h.servicenameid;i.type=h.eventtype;i.description=h.event};if(f.welcome()===true||f.welcome()=="1"){d.getJSON("session/get?key=welcome",function(h){if(typeof h.welcome==="undefined"||h.welcome!="0"){f.showwelcome(true)}})}d.ajaxSetup({timeout:30000});f.load()};ko.applyBindings(a);d("#statusbox").click(function(g,h,f){window.location="status/hosts/";return false});d("#eventsbox").click(function(g,h,f){window.location="reports/events/";return false})})(jQuery);