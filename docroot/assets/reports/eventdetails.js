(function(b){var a=function(){var d=this;d.width=ko.observable(b("#main").outerWidth());d.isPhone=ko.computed(function(){return d.width()<768});d.id=ko.observable();d.hostid=ko.observable();d.host=ko.observable("");d.date=ko.observable("");d.servicename=ko.observable("");d.servicetype=ko.observable("");d.event=ko.observable("");d.eventstate=ko.observable();d.action=ko.observable("");d.message=ko.observable("");d.notes=ko.observableArray();d.notice=ko.observable("").extend({required:true});d.hosturl=ko.computed(function(){return"../../status/hosts/detail?id="+d.hostid()});d.eventstateColor=ko.computed(function(){switch(d.eventstate()){case 5:case 4:return"gray";case 3:case 2:return"orange";case 1:return"red";default:return"green"}});d.save=function(){if(d.notice.isValid()){b.ajaxSettings.traditional=true;b.post("notice",b.param({id:d.id(),notice:d.notice()}),function(){window.location="."}).error(MMONIT.error.json)}else{d.notice.valueHasMutated();b("#notice").focus()}};b.getJSON("../../reports/events/get?id="+b(document).getUrlParam("id"),function(e){d.id(e.id);d.hostid(e.hostid);d.host(e.host);d.date(strftime("%b %d %Y %H:%M:%S",new Date(e.date*1000)));d.servicename(e.servicename);d.servicetype(e.servicetype);d.event(e.event);d.eventstate(e.eventstate);d.action(e.action);d.message(e.message);b.map(e.note,function(g,f){d.notes.push({date:strftime("%b %d %Y %H:%M:%S",new Date(g.date*1000)),message:g.message,uname:g.uname})})}).error(MMONIT.error.json);(function c(){d.width(b("#main").outerWidth());b(window).off("resize orientationchange").on("resize orientationchange",c)})()};ko.validation.init({insertMessages:false,decorateElement:true,errorElementClass:"error"},true);ko.applyBindings(new a())})(jQuery);