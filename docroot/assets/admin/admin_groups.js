(function(d){var c=function(j,h,i){var g=this;g.oldName=h;g.isInitialized=false;g.rawHostsInGroup=i?i:[];g.id=j;g.name=ko.observable(h);g.editing=ko.observable(!h);g.hostsInGroup=ko.observableArray();g.availableHosts=ko.observableArray();g.hostsInGroupSelected=ko.observableArray();g.availableHostsSelected=ko.observableArray();g.initialize=function(){if(!g.isInitialized){g.isInitialized=true;g.availableHosts(b.hosts.slice());var k=g.availableHosts.remove(function(m){for(var l=0;l<g.rawHostsInGroup.length;l++){if(g.rawHostsInGroup[l]==m.id){return true}}return false});g.hostsInGroup.push.apply(g.hostsInGroup,k)}};g.updateName=function(k,l){l.stopImmediatePropagation();if(d.trim(g.name()).length<=0){g.editing(true)}else{g.editing(false);if(g.oldName!==g.name()){g.oldName=g.name();if(!g.id){d.post("../../admin/groups/create",{name:g.name()},function(m){g.id=m;if(b.expandedRow()===null){b.toggleExpand(g)}}).error(MMONIT.error.json)}else{d.post("../../admin/groups/update",{id:g.id,name:g.name()}).error(MMONIT.error.json)}}}};g.edit=function(l,k){g.oldName=g.name();g.editing(true);k.stopPropagation()};g.stopEdit=function(){if(d.trim(g.name()).length>0){g.editing(false)}};g.addHostsToGroup=function(){if(g.name()&&g.availableHostsSelected().length){var k="id="+g.id+e("hostid",g.availableHostsSelected());d.post("../../admin/groups/add",k,function(l){g.move(g.availableHostsSelected(),g.availableHosts,g.hostsInGroup);g.availableHostsSelected.removeAll()}).error(MMONIT.error.json)}};g.removeHostsFromGroup=function(){if(g.name()&&g.hostsInGroupSelected().length){var k="id="+g.id+e("hostid",g.hostsInGroupSelected());d.post("../../admin/groups/remove",k,function(l){g.move(g.hostsInGroupSelected(),g.hostsInGroup,g.availableHosts);g.hostsInGroupSelected.removeAll()}).error(MMONIT.error.json)}};g.move=function(k,m,l){l.push.apply(l,k);m.removeAll(k);l.sort(a);m.sort(a)}};var b=new function(){var g=this;g.group=ko.observable();g.hosts=[];g.expandedRow=ko.observable();g.groups=ko.observableArray();g.shouldPushDown=function(){return !(ISPHONE||ISTABLET)};g.confirmDelete=function(h){g.group(h)};g.toggleExpand=function(i){var h=g.expandedRow()!==i;if(h){i.initialize()}g.expandedRow(h?i:null)};g.isExpanded=function(h){return(h===g.expandedRow())};g.remove=function(h){d.post("../../admin/groups/delete",{id:h.id},function(i){g.groups.remove(h)}).error(MMONIT.error.json)};g.add=function(h,i){i.stopImmediatePropagation();g.expandedRow(null);g.groups.push(new c())};d.getJSON("../../admin/groups/list",function(k){g.hosts=k.hosts.sort(a);var h=k.groups;for(var j=0;j<h.length;j++){g.groups.push(new c(h[j].id,h[j].name,h[j].hosts))}g.groups.sort(f)}).error(MMONIT.error.json)};ko.applyBindings(b);ko.bindingHandlers.onEnter={init:function(h,i,j,g){ko.utils.registerEventHandler(h,"keydown",function(k){if(k.keyCode===13){i().call(g)}})}};var a=function(h,g){var i=h.name.toLowerCase().localeCompare(g.name.toLowerCase());return i?i:h.name>g.name?1:h.name<g.name?-1:0};var f=function(h,g){var i=h.name().toLowerCase().localeCompare(g.name().toLowerCase());return i?i:h.name()>g.name()?1:h.name()<g.name()?-1:0};var e=function(k,g){var j=[];for(var h=0;h<g.length;h++){j.push("&");j.push(k);j.push("=");j.push(g[h].id)}return j.join("")}})(jQuery);