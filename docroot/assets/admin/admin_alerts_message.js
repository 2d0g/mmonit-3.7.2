(function(b){var a=new function(){var c=this;c.width=ko.observable(b("#main").outerWidth());c.message={save:function(){if(!c.message.loading&&!c.message.hasErrors()){b.ajaxSettings.traditional=true;b.ajax({url:"../../admin/messages/update",data:b.param({sender:c.message.format.sender(),contenttype:Menu.getSelectedValues(c.message.format.contenttype.menu(),"id"),maxevents:Menu.getSelectedValues(c.message.format.maxevents.menu(),"id"),flushinterval:Menu.getSelectedValues(c.message.queue.flushinterval.menu(),"id")}),type:"POST",dataType:"json",timeout:30000,error:MMONIT.error.json})}},hasErrors:function(){return !(c.message.format.sender.isValid())},loading:true,format:{sender:ko.observable().extend({required:true,maxLength:255}),subjectsingle:ko.observable(),subjectmulti:ko.observable(),txtheader:ko.observable(),txtbody:ko.observable(),txtfooter:ko.observable(),htmlheader:ko.observable(),htmlbody:ko.observable(),htmlfooter:ko.observable(),contenttype:{menu:ko.observableArray(Menu.JSONToMenu([{id:"0",name:"Multipart"},{id:"1",name:"Plain text"},{id:"2",name:"HTML"}])),select:function(d){Menu.select(c.message.format.contenttype.menu(),d.id);c.message.save()}},maxsize:{menu:ko.observableArray(Menu.JSONToMenu([{id:"524288",name:"500 kB"},{id:"1048576",name:"1 MB"},{id:"2097152",name:"2 MB"},{id:"3145728",name:"3 MB"},{id:"4194304",name:"4 MB"},{id:"5242880",name:"5 MB"}])),select:function(d){Menu.select(c.message.format.maxsize.menu(),d.id);c.message.save()}},maxevents:{menu:ko.observableArray(Menu.JSONToMenu([{id:"20",name:"20"},{id:"50",name:"50"},{id:"100",name:"100"},{id:"200",name:"200"},{id:"500",name:"500"},{id:"1000",name:"1000"},])),select:function(d){Menu.select(c.message.format.maxevents.menu(),d.id);c.message.save()}}},queue:{flushinterval:{menu:ko.observableArray(Menu.JSONToMenu([{id:"1",name:"None"},{id:"30",name:"30 seconds"},{id:"60",name:"1 minute"},{id:"300",name:"5 minutes"},{id:"900",name:"15 minutes"}])),select:function(d){Menu.select(c.message.queue.flushinterval.menu(),d.id);c.message.save()}}}};c.message.format.sender.subscribe(c.message.save);c.message.format.contenttype.label=ko.computed(function(){return Menu.getSelectedNames(c.message.format.contenttype.menu(),null)});c.message.format.maxsize.label=ko.computed(function(){return Menu.getSelectedNames(c.message.format.maxsize.menu(),null)});c.message.format.maxevents.label=ko.computed(function(){return Menu.getSelectedNames(c.message.format.maxevents.menu(),null)});c.message.queue.flushinterval.label=ko.computed(function(){return Menu.getSelectedNames(c.message.queue.flushinterval.menu(),null)});b.getJSON("../../admin/messages/list",function(d){c.message.format.sender(d.format.sender);c.message.format.subjectsingle(d.format.subjectsingle);c.message.format.subjectmulti(d.format.subjectmulti);c.message.format.txtheader(d.format.txtheader);c.message.format.txtbody(d.format.txtbody);c.message.format.txtfooter(d.format.txtfooter);c.message.format.htmlheader(d.format.htmlheader);c.message.format.htmlbody(d.format.htmlbody);c.message.format.htmlfooter(d.format.htmlfooter);Menu.select(c.message.format.contenttype.menu(),d.format.contenttype);Menu.select(c.message.format.maxsize.menu(),d.format.maxsize);Menu.select(c.message.format.maxevents.menu(),d.format.maxevents);Menu.select(c.message.queue.flushinterval.menu(),d.queue.flushinterval);c.message.loading=false}).error(MMONIT.error.json)};ko.validation.init({insertMessages:false,decorateElement:true,errorElementClass:"error"},true);ko.applyBindings(a,document.getElementById("messageTab"));b(window).on("resize orientationchange",function(c){a.width(b("#main").outerWidth())})})(jQuery);