(function(b){var a=function(){var d=this;d.popoverplacement="right";d.id=b(document).getUrlParam("id");d.availableHostStatuses=["Active","Inactive","Ignored"];d.ipaddrin=ko.observable("");d.portin=ko.observable("");d.sslin=ko.observable(0);d.monitid=ko.observable("");d.lastmodified=ko.observable("");d.poll=ko.observable(3);d.hostname=ko.observable("").extend({required:true,maxLength:255});d.keepname=ko.observable(0);d.monituser=ko.observable().extend({required:true,maxLength:55});d.monitpassword=ko.observable().extend({required:true,maxLength:55});d.description=ko.observable("").extend({maxLength:1024});d.status=ko.observable(1);d.skew=ko.observable().extend({number:true,min:1});d.defaultskew=ko.observable();d.connectionStatus=ko.observable("");d.connectionInfo=ko.observable("");d.enableNetworkOverride=ko.observable(false);d.ipaddrout=ko.observable().extend({maxLength:255});d.portout=ko.observable().extend({number:true});d.sslout=ko.observable(-1);d.ssl=ko.computed({read:function(){return(d.sslout()==-1?d.sslin():d.sslout())?true:false},write:function(e){d.sslout(e?1:0)},owner:d});d.hostname.subscribe(function(){d.keepname(1)});d.skewSubscription=d.skew.subscribe(function(e){if(parseInt(e)<1){d.skew(1)}});d.deleteHost=function(){b.post("../../admin/hosts/delete","id="+d.id,function(){window.location="."}).fail(MMONIT.error.json)};d.updateHost=function(){var e=b("#theform").serialize();b.post("../../admin/hosts/update",e+"&id="+d.id,function(){window.location="."}).fail(MMONIT.error.json)};d.toggleNetworkOverride=function(){d.enableNetworkOverride(!d.enableNetworkOverride())};d.hasErrors=function(){return !(d.hostname.isValid()&&d.ipaddrout.isValid()&&d.portout.isValid()&&d.monituser.isValid()&&d.monitpassword.isValid())};d.cancel=function(){window.location="."};d.test=function(g,f){d.connectionStatus("spin");d.connectionInfo("Connecting...");if(!d.hasErrors()){var e={ipaddr:d.ipaddrout()!=""?d.ipaddrout():d.ipaddrin(),port:d.portout()>0?d.portout():d.portin(),ssl:(d.sslout()==-1?d.sslin():d.sslout())?1:0,monituser:d.monituser(),monitpassword:d.monitpassword()};b.ajax({url:"../../admin/hosts/test",data:b.param(e),type:"GET",dataType:"json",timeout:30000,success:function(i,j,h){d.connectionStatus(i.status);d.connectionInfo(i.description);if(g){b("#connection-status").popover("show")}},error:function(h,j,i){d.connectionStatus("red");d.connectionInfo(h.responseText);if(g){b("#connection-status").popover("show")}}})}else{d.connectionStatus("orange");d.connectionInfo("Required fields (Monit address, port, user and password) are invalid or not set.");if(g){b("#connection-status").popover("show")}}};(function c(){b.getJSON("../../admin/hosts/json/get?id="+d.id,function(f){ko.mapping.fromJS(f,{},d);var e=new Date(f.lastmodified*1000);d.lastmodified(e.toLocaleDateString()+" "+(e.getHours()<10?"0":"")+e.getHours()+":"+(e.getMinutes()<10?"0":"")+e.getMinutes()+":"+(e.getSeconds()<10?"0":"")+e.getSeconds());if(d.portout()<=0){d.portout("")}if(b.trim(d.ipaddrout()).length||d.portout()!=""||d.sslout()!=-1){d.toggleNetworkOverride()}d.defaultskew(f.defaultskew);if(d.status()==0){d.test()}}).error(MMONIT.error.json);if(ISPHONE){d.popoverplacement="left";b("#actions .btn").addClass("btn-block")}else{b("span.accessory input").prop("size",100)}if(!ISPHONE&&!ISTABLET){b("#connection-status").hover(function(f){b(f.target).popover("show")},function(f){b(f.target).popover("hide")})}b(document).on("vclick",function(f){if(!b(f.target).parents("#test-connection").length){b("#connection-status").popover("hide")}})})()};ko.validation.init({insertMessages:false,decorateElement:true,errorElementClass:"error"});ko.applyBindings(new a());b(window).on("resize orientationchange",function(c){b("#connection-status").popover("hide")})})(jQuery);