"use strict";(function(b){var a=new function(){var c=this;c.original_uname=b(document).getUrlParam("uname");c.original_password="";c.file=null;c.fullname=ko.observable().extend({required:true,maxLength:255});c.uname=ko.observable().extend({required:true,maxLength:20});c.password=ko.observable().extend({required:true,maxLength:55});c.title=ko.observable();c.email=ko.observable().extend({email:true});c.phone=ko.observable().extend({pattern:"^[+()0-9-]{6,40}$"});c.mobile=ko.observable().extend({pattern:"^[+()0-9-]{6,40}$"});c.imname=ko.observable();c.imtype=ko.observable();c.admin=ko.observable(false);c.image=ko.observable();c.isnew=ko.observable(true);c.hasErrors=function(){return !(c.fullname.isValid()&&c.uname.isValid()&&c.password.isValid()&&c.email.isValid()&&c.phone.isValid()&&c.mobile.isValid())};c.cancel=function(){window.location="."};c.deleteUser=function(){b.post("../../admin/users/delete","uname="+c.original_uname,function(d){window.location="."}).error(MMONIT.error.json)};c.saveUser=function(){setTimeout("$('#button-spinner').addClass('visible')",300);var e=b("#theform").serialize();var d="../../admin/users/create";if(c.original_uname){e+="&uname="+encodeURIComponent(c.original_uname)+"&oldpassword="+encodeURIComponent(c.original_password);d="../../admin/users/update"}if(c.file){var g="id"+(new Date()).getTime()+c.file.name.substr(c.file.name.lastIndexOf("."));var f=new FormData();f.append("fileid",g);f.append("uploadimage",c.file);b.ajax({url:"upload",data:f,type:"POST",cache:false,contentType:false,processData:false,success:function(){b.post(d,e+"&image="+g,function(){window.location="."}).error(MMONIT.error.json)}}).error(MMONIT.error.json)}else{b.post(d,e,function(){window.location="."}).error(MMONIT.error.json)}};if(c.original_uname){c.original_uname=decodeURIComponent(c.original_uname);b.getJSON("../../admin/users/get?uname="+encodeURIComponent(c.original_uname),function(d){ko.mapping.fromJS(d,{},c);c.original_password=c.password();c.isnew(false);var e=c.image();e=(e&&(e.length>0))?("../../uploads/"+e):"../../img/avatar.png";document.getElementById("preview").style.background="url("+e+") no-repeat center"}).error(MMONIT.error.json)}else{document.getElementById("preview").style.background="url(../../img/avatar.png) no-repeat center"}};ko.bindingHandlers.selectText={init:function(c){b(c).click(function(){b(this).select()})}};ko.validation.init({insertMessages:false,decorateElement:true,errorElementClass:"error"});ko.applyBindings(a);if(b(window).width()<768){b("#actions .btn").addClass("btn-block")}else{b("span.accessory input").prop("size",100)}(function(){var e=document.getElementById("preview");var f=function(g){var h=(g.name.substr(g.name.lastIndexOf(".")+1)).toLowerCase();if(b.inArray(h,["gif","png","tiff","jpg","jpeg"])==-1){MMONIT.error.abort("File type not supported. Supported file types are gif, png, tiff, jpeg and jpg")}};var d=function(h){var g=new FileReader();g.onload=function(i){a.file=h;e.style.background="url("+i.target.result+") no-repeat center"};g.readAsDataURL(h)};var c=document.getElementById("fileInput");c.onchange=function(h){h.preventDefault();var g=h.target.files[0];f(g);d(g);return false}})()})(jQuery);